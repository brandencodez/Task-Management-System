<div class="ua-container">
  <div class="ua-header">
    <div class="header-left">
      <div class="header-icon">
        <svg width="32" height="32" viewBox="0 0 24 24" fill="none">
          <rect x="3" y="4" width="18" height="18" rx="2" stroke="currentColor" stroke-width="2"/>
          <line x1="3" y1="9" x2="21" y2="9" stroke="currentColor" stroke-width="2"/>
          <line x1="8" y1="14" x2="10" y2="14" stroke="currentColor" stroke-width="2"/>
          <line x1="8" y1="18" x2="10" y2="18" stroke="currentColor" stroke-width="2"/>
          <line x1="14" y1="14" x2="16" y2="14" stroke="currentColor" stroke-width="2"/>
        </svg>
      </div>
      <div class="title-group">
        <h1>My Attendance</h1>
        <p class="sub">{{ currentUserName || 'Employee' }} ‚Ä¢ Real-time attendance tracking</p>
      </div>
    </div>
    <div class="pill">{{ currentMonth }}</div>
  </div>

  <div class="ua-stats">
    <div class="stat stat-present">
      <span class="value">{{ presentCount }}</span>
      <span class="label">PRESENT</span>
    </div>
    <div class="stat stat-absent">
      <span class="value">{{ absentCount }}</span>
      <span class="label">ABSENT</span>
    </div>
    <div class="stat stat-halfday">
      <span class="value">{{ halfDayCount }}</span>
      <span class="label">HALF DAY</span>
    </div>
    <div class="stat stat-leave">
      <span class="value">{{ leaveCount }}</span>
      <span class="label">ON LEAVE</span>
    </div>
  </div>

  <!-- TODAY CARD -->
  <div class="ua-card today-card">
    <div class="card-header">
      <div class="header-left">
        <h3>Today's Attendance</h3>
        <span class="today-date">{{ todayRecord?.date | date:'EEEE, MMMM d, yyyy' }}</span>
      </div>
      <span class="badge" [ngClass]="getStatusColor(isPendingLeave ? 'pending' : (todayRecord?.status || 'not-marked'))">
        {{ isPendingLeave ? 'PENDING LEAVE' : (todayRecord?.status ? todayRecord.status.toUpperCase() : 'NOT MARKED') }}
      </span>
    </div>

    <!-- CHECK IN VIEW - Show if no attendance marked and no pending leave -->
    <div class="card-body" *ngIf="!hasMarkedToday && !isOnLeaveToday && !isPendingLeave">
      <div class="check-in-section">
        <div class="check-in-info">
          <div class="info-icon">üïê</div>
          <div class="info-text">
            <h4>Ready to start your day?</h4>
            <p>Check in to mark your attendance for today</p>
          </div>
        </div>

        <div class="action-buttons">
          <button class="btn-check-in" (click)="markAttendance()">
            <span class="btn-icon">‚úì</span>
            <span>Check In</span>
          </button>

          <button class="btn-leave" (click)="openLeaveModal()">
            <span class="btn-icon">üìù</span>
            <span>Apply for Leave</span>
          </button>
        </div>
      </div>
    </div>

    <!-- PENDING LEAVE VIEW - NEW -->
    <div class="card-body" *ngIf="isPendingLeave">
      <div class="pending-section">
        <div class="pending-info">
          <span class="pending-icon">‚è≥</span>
          <div class="pending-text">
            <h4>Leave Request Pending</h4>
            <p>Your leave request is awaiting admin approval. You'll be notified once it's reviewed.</p>
          </div>
        </div>
        
        <!-- Optional: Allow check-in while leave is pending -->
        <div class="pending-actions">
          <p class="hint-text">You can still check in for today while waiting for approval</p>
          <button class="btn-check-in-alt" (click)="markAttendance()">
            <span class="btn-icon">‚úì</span>
            <span>Check In Anyway</span>
          </button>
        </div>
      </div>
    </div>

    <!-- PRESENT / HALF DAY VIEW -->
    <div class="card-body"
         *ngIf="hasMarkedToday && !isPendingLeave && (todayRecord?.status === 'present' || todayRecord?.status === 'half-day')">

      <div class="attendance-summary">
        <div class="summary-item">
          <div class="summary-label">Check-in Time</div>
          <div class="summary-value">{{ formatTime(todayRecord?.checkInTime) }}</div>
        </div>
        <div class="summary-divider"></div>
        <div class="summary-item">
          <div class="summary-label">Check-out Time</div>
          <div class="summary-value">{{ formatTime(todayRecord?.checkOutTime) }}</div>
        </div>
        <div class="summary-divider"></div>
        <div class="summary-item">
          <div class="summary-label">Work Hours</div>
          <div class="summary-value">{{ todayRecord?.workHours || 0 }}h</div>
        </div>
      </div>

      <!-- CHECKOUT BUTTON -->
      <div class="checkout-section" *ngIf="!hasCheckedOutToday">
        <div class="checkout-info">
          <span class="status-indicator"></span>
          <span class="status-text">You are currently checked in</span>
        </div>
        <button class="btn-check-out" (click)="checkOut()">
          <span class="btn-icon">‚Üí</span>
          <span>Check Out</span>
        </button>
      </div>

      <!-- COMPLETED -->
      <div class="completed-section" *ngIf="hasCheckedOutToday">
        <div class="completed-info">
          <span class="completed-icon">‚úì</span>
          <span class="completed-text">Attendance marked for today</span>
        </div>
      </div>

    </div>

    <!-- APPROVED LEAVE VIEW -->
    <div class="card-body" *ngIf="isOnLeaveToday && !isPendingLeave">
      <div class="completed-section leave-success">
        <div class="completed-info">
          <span class="completed-icon">‚úÖ</span>
          <span class="completed-text">
            Leave approved. Enjoy your time off!
          </span>
        </div>
      </div>
    </div>

  </div>

  <!-- HISTORY -->
  <div class="ua-card">
    <div class="card-header">
      <h3>Attendance History</h3>
      <span class="record-count" *ngIf="myAttendance.length">
        {{ myAttendance.length }} record{{ myAttendance.length !== 1 ? 's' : '' }}
      </span>
    </div>

    <div class="history-wrapper" *ngIf="myAttendance.length">
      <div class="history-table">
        <div class="history-row header-row">
          <span>Date</span>
          <span>Status</span>
          <span>Check In</span>
          <span>Check Out</span>
          <span>Hours</span>
        </div>

        <div class="history-row data-row" *ngFor="let record of myAttendance">
          <span class="date-cell">{{ record.date | date:'dd MMM, yyyy' }}</span>
          <span class="status-cell">
            <span class="status-badge" [ngClass]="getStatusColor(record.status)">
              {{ record.status === 'pending' ? 'PENDING LEAVE' : record.status.toUpperCase() }}
            </span>
          </span>
          <span class="time-cell">{{ formatTime(record.checkInTime) }}</span>
          <span class="time-cell">{{ formatTime(record.checkOutTime) }}</span>
          <span class="hours-cell">{{ record.workHours || 0 }}h</span>
        </div>
      </div>
    </div>

    <div class="empty-state" *ngIf="!myAttendance.length">
      <div class="empty-icon">üìã</div>
      <p class="empty-title">No Records Yet</p>
      <p class="empty-text">Your attendance history will appear here</p>
    </div>
  </div>

  <!-- Leave Request Modal -->
  <div class="modal-backdrop" *ngIf="showLeaveModal" (click)="closeLeaveModal()">
    <div class="leave-modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <div class="modal-title-group">
          <div class="modal-icon">üìù</div>
          <h3>Apply for Leave</h3>
        </div>
        <button class="close-btn" (click)="closeLeaveModal()">
          <span>‚úï</span>
        </button>
      </div>

      <div class="modal-body">
        <div class="form-group">
          <label>From Date</label>
          <input type="date" [(ngModel)]="leaveFrom" class="form-input">
        </div>

        <div class="form-group">
          <label>To Date</label>
          <input type="date" [(ngModel)]="leaveTo" class="form-input">
        </div>

        <div class="form-group">
          <label>Reason for Leave</label>
          <textarea rows="4" [(ngModel)]="leaveReason" class="form-textarea" placeholder="Please provide a reason for your leave request..."></textarea>
        </div>
      </div>

      <div class="modal-footer">
        <button class="modal-btn cancel-btn" (click)="closeLeaveModal()">Cancel</button>
        <button class="modal-btn submit-btn" (click)="submitLeave()">Submit Request</button>
      </div>
    </div>
  </div>
</div>