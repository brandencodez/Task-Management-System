<div class="container">
  <div class="page-header">
    <h2>Project Management</h2>
    <button class="btn btn-primary" (click)="openAddForm()">
      Add Project
    </button>
  </div>

  <!-- Project Form (Add/Edit) -->
  @if (showForm) {
    <div class="card form-card">
      <h3>{{ isEditing ? 'Edit Project' : 'Add Project' }}</h3>
      <form (ngSubmit)="saveProject()" class="form-grid">
        <div class="form-group">
          <label class="form-label">Project Name *</label>
          <input 
            [(ngModel)]="currentProject.name" 
            name="name" 
            required 
            class="form-control"
            placeholder="e.g., Website Redesign"
          />
        </div>

        <div class="form-group">
          <label class="form-label">Project Type</label>
          <select 
            [(ngModel)]="currentProject.projectType" 
            name="projectType" 
            class="form-control"
            [disabled]="!currentProject.department"
          >
            <option value="">Select Project Type</option>
            @for (type of getProjectTypes(); track type) {
              <option [value]="type">{{ type }}</option>
            }
          </select>
          @if (!currentProject.department) {
            <p class="help-text">Select a department first to see project types</p>
          }
        </div>

        <div class="form-group">
          <label class="form-label">Department *</label>
          <select 
            [(ngModel)]="currentProject.department" 
            name="department" 
            required 
            class="form-control"
          >
            <option value="">Select Department</option>
            <option value="Development">Development</option>
            <option value="HR">HR</option>
            <option value="Marketing">Marketing</option>
            <option value="Sales">Sales</option>
            <option value="Finance">Finance</option>
          </select>
        </div>

        <!-- COMPACT CLIENT DETAILS SECTION -->
        <div class="form-group client-section">
          <label class="form-label">Client Details *</label>
          
          <!-- Company Name -->
          <div class="form-group">
            <input 
              [(ngModel)]="currentProject.clientDetails.companyName" 
              name="companyName" 
              class="form-control"
              placeholder="Company Name *"
              required
            />
          </div>

          <!-- Address (inline with company name) -->
          <div class="form-group">
            <input 
              [(ngModel)]="currentProject.clientDetails.address" 
              name="address" 
              class="form-control"
              placeholder="Address *"
            />
          </div>

          <!-- Multiple Contacts -->
          <div class="contacts-container">
            @for (contact of currentProject.clientDetails.contacts; track $index) {
              <div class="contact-row">
                <!-- Contact Name -->
                <div class="form-group contact-name">
                  <input 
                    [(ngModel)]="currentProject.clientDetails.contacts[$index].name" 
                    [name]="'contactName' + $index" 
                    class="form-control"
                    placeholder="Contact Name *"
                    required
                  />
                </div>
                
                <!-- Email -->
                <div class="form-group contact-email">
                  <input 
                    type="email"
                    [(ngModel)]="currentProject.clientDetails.contacts[$index].email" 
                    [name]="'contactEmail' + $index" 
                    class="form-control"
                    placeholder="Email"
                  />
                </div>
                
                <!-- Phone -->
                <div class="form-group contact-phone">
                  <input 
                    [(ngModel)]="currentProject.clientDetails.contacts[$index].phone" 
                    [name]="'contactPhone' + $index" 
                    class="form-control"
                    placeholder="Phone"
                  />
                </div>
                
                <!-- Remove Button (only if more than 1 contact) -->
                @if (currentProject.clientDetails.contacts.length > 1) {
                  <button type="button" class="btn-remove-contact" (click)="removeClientContact($index)">
                    Ã—
                  </button>
                }
              </div>
            }
            
            <!-- Add Contact Button -->
            <button type="button" class="btn-add-contact" (click)="addClientContact()">
              + Add Contact
            </button>
          </div>
        </div>
        
        <div class="form-group">
          <label class="form-label">Project Brief</label>
          <textarea 
            [(ngModel)]="currentProject.projectBrief" 
            name="projectBrief" 
            class="form-control"
            rows="4"
            placeholder="Describe project scope, requirements, deliverables"
          ></textarea>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Start Date *</label>
            <input 
              type="date" 
              [(ngModel)]="currentProject.startDate" 
              name="startDate" 
              required 
              class="form-control"
            />
          </div>
          
          <div class="form-group">
            <label class="form-label">Finish Date *</label>
            <input 
              type="date" 
              [(ngModel)]="currentProject.finishDate" 
              name="finishDate" 
              required 
              class="form-control"
            />
          </div>
        </div>

        <div class="form-group">
          <label class="form-label">Status</label>
          <select 
            [(ngModel)]="currentProject.status" 
            name="status" 
            class="form-control"
          >
            @for (status of statuses; track status) {
              <option [value]="status">{{ status }}</option>
            }
          </select>
        </div>
        
        <div class="form-actions">
          <button type="submit" class="btn btn-success">
            {{ isEditing ? 'Update Project' : 'Save Project' }}
          </button>
          <button type="button" class="btn btn-outline" (click)="cancelForm()">Cancel</button>
        </div>
      </form>
    </div>
  }

  <!-- Projects by Status -->
  @for (status of statuses; track status) {
    @if (getProjectsByStatus(status).length > 0) {
      <div class="status-section">
        <h3 class="section-title">{{ status }} Projects</h3>
        <div class="projects-grid">
          @for (project of getProjectsByStatus(status); track project.id) {
            <div class="project-card">
              <div class="project-header">
                <h4>{{ project.name }}</h4>
                <span class="badge badge-{{ status.toLowerCase() }}">{{ status }}</span>
              </div>
              
              <div class="project-details">
                <p><strong>Type:</strong> {{ project.projectType || 'Not specified' }}</p>
                <div class="client-details">
                  <p><strong>Company:</strong> {{ project.clientDetails.companyName || 'Not specified' }}</p>
                  @for (contact of project.clientDetails.contacts; track $index) {
                    <p><strong>Contact {{ $index + 1 }}:</strong> {{ contact.name }} 
                      @if (contact.email || contact.phone) {
                        ({{ contact.email || contact.phone }})
                      }
                    </p>
                  }
                  @if (project.clientDetails.address) {
                    <p><strong>Address:</strong> {{ project.clientDetails.address }}</p>
                  }
                </div>
                <p><strong>Department:</strong> {{ project.department || 'Not specified' }}</p>
                <p><strong>Duration:</strong> {{ project.startDate }} to {{ project.finishDate }}</p>
                <p>{{ project.projectBrief || 'No brief provided' }}</p>
              </div>
              
              <div class="project-actions">
                <button class="btn btn-outline" (click)="openEditForm(project)">
                  Edit
                </button>
                <button class="btn btn-danger" (click)="deleteProject(project.id)">
                  Delete
                </button>
              </div>
            </div>
          }
        </div>
      </div>
    }
  }

  @if (projects.length === 0 && !showForm) {
    <div class="no-results">
      <p>No projects yet. Click "Add Project" to get started.</p>
    </div>
  }
</div>