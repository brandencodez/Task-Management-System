<div class="daily-work-container">

  <!-- SECTION TITLE -->
  <h3 class="section-title">Daily Work Entry</h3>

  <!-- ===== ENTRY FORM ===== -->
  <div class="entry-form">

    <!-- Project -->
    <div class="form-group">
      <label>Project <span class="required">*</span></label>
      <select [(ngModel)]="project">
        <option value="">Select project</option>
        <option *ngFor="let p of assignedProjects" [value]="p.name">
          {{ p.name }}
        </option>
      </select>
    </div>

    <!-- Hours -->
    <div class="form-group">
      <label>Hours Worked <span class="required">*</span></label>
      <input
        type="number"
        placeholder="e.g. 4"
        [(ngModel)]="hours"
        min="0"
        max="24"
        required
      />
    </div>

    <!-- Date -->
    <div class="form-group">
      <label>Date <span class="required">*</span></label>
      <input type="date" [(ngModel)]="date" readonly />
    </div>
    
    <!-- Description -->
    <div class="form-group full-width">
      <label>Work Description <span class="required">*</span></label>
      <textarea
        placeholder="Describe what you worked on today..."
        [(ngModel)]="description"
        required>
      </textarea>
    </div>

    <!-- Attachments Upload -->
    <div class="form-group full-width">
      <label>Attachments (Max 5 files) *</label>
      
      <!-- File Upload Area -->
      <div class="file-upload-area">
        <div class="file-drop-zone" 
             (dragover)="onDragOver($event)" 
             (dragleave)="onDragLeave($event)"
             (drop)="onDrop($event)"
             [class.drag-over]="isDragging">
          <input 
            type="file" 
            id="attachmentInput"
            #attachmentInput
            multiple
            (change)="onFilesSelected($event)"
            accept=".jpg,.jpeg,.png,.gif,.pdf,.doc,.docx,.xls,.xlsx,.csv,.ppt,.pptx,.txt,.mp4,.mp3,.wav,.zip,.rar,.7z"
            class="file-input"
          />
          <label for="attachmentInput" class="file-label">
            <div class="upload-icon">ðŸ“Ž</div>
            <div class="upload-text">
              <div *ngIf="!isDragging">
                Click to select files or drag & drop here
              </div>
              <div *ngIf="isDragging">
                Drop files here...
              </div>
              <small class="file-hint">Images, PDF, DOC/X, XLS/X, CSV, PPT/X, TXT, MP4, MP3, ZIP (Max file size 100 MB)</small>
            </div>
          </label>
        </div>
      </div>

      <!-- Selected Files Preview -->
      <div class="selected-files" *ngIf="selectedFiles.length">
        <div class="selected-file-item" *ngFor="let file of selectedFiles; let i = index">
          <div class="file-info">
            <span class="file-icon">
              {{ getFileIcon(file.type) }}
            </span>
            <div class="file-details">
              <div class="file-name">{{ file.name }}</div>
              <div class="file-meta">
                {{ workEntryService.formatFileSize(file.size) }} â€¢ 
                {{ file.type.split('/')[1] | uppercase }}
              </div>
            </div>
          </div>
          <button 
            class="remove-file-btn" 
            (click)="removeFile(i)"
            title="Remove"
          >
            âœ•
          </button>
        </div>
      </div>
    </div>

    <!-- Submit -->
    <div class="form-group full-width">
      <button class="add-btn" (click)="submitEntry()" [disabled]="isSubmitting">
        {{ isSubmitting ? 'Submitting...' : 'âž• Submit Work Entry' }}
      </button>
    </div>

  </div>
  
  <!-- SECTION TITLE -->
   <hr class="section-divider" />
  <h4 class="section-title">My Work Entries</h4>

  <!-- ===== ENTRIES LIST ===== -->
  <div class="entries" *ngIf="entries.length">

    <div class="entry-card" *ngFor="let entry of entries">

      <div class="entry-header">
        <strong>{{ entry.project }}</strong>
         <span class="entry-date">{{ formatDateForDisplay(entry.date) }}</span>
      </div>

      <p class="entry-desc">{{ entry.description }}</p>

      <!-- Attachments -->
      <div *ngIf="entry.attachments?.length" class="entry-attachments">
        <div class="attachments-label">
          ðŸ“Ž {{ entry.attachments?.length || 0 }} attachment{{ (entry.attachments?.length || 0) > 1 ? 's' : '' }}
        </div>
        <div class="entry-attachments-list">
          <div class="entry-attachment-item" *ngFor="let att of entry.attachments">
            <span class="entry-att-icon">{{ getFileIcon(att.mime_type) }}</span>
            <div class="entry-att-info">
              <div class="entry-att-name">{{ att.original_name }}</div>
              <div class="entry-att-meta">
                {{ workEntryService.formatFileSize(att.file_size) }} â€¢ 
                {{ att.mime_type.split('/')[1] | uppercase }}
              </div>
            </div>
            <a 
              [href]="getAttachmentUrl(att.filename)" 
              target="_blank"
              rel="noopener noreferrer"
              class="entry-att-view"
              title="View/Open"
            >
              View
            </a>
          </div>
        </div>
      </div>

      <div *ngIf="!entry.attachments?.length" class="no-attachments-note">
        No attachments
      </div>

      <div class="actions">
        <button class="delete" (click)="deleteEntry(entry.id)">
          Delete Entry
        </button>
      </div>

    </div>
  </div>

  <!-- EMPTY STATE -->
  <p class="empty-text" *ngIf="!entries.length">
    No work entries yet. Start by creating one above ðŸ‘†
  </p>

</div>